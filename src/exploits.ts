import {NS} from "@ns";

declare global {
    // eslint-disable-next-line no-var, @typescript-eslint/no-explicit-any
    var webpackRequire: any;
    // eslint-disable-next-line no-var, @typescript-eslint/no-explicit-any
    var webpackChunkbitburner: any;
}

let ns: NS;
let doc: Document;

function unclickable() {
    const unclickableDiv = doc.querySelector<HTMLDivElement>("#unclickable")!;
    unclickableDiv.style.display = "block";
    unclickableDiv.style.visibility = "visible";
    unclickableDiv.style.backgroundColor = "red";
    unclickableDiv.addEventListener("click", () => {
        unclickableDiv.style.display = "none";
        unclickableDiv.style.visibility = "hidden";
    });
}

function undocumented() {
    // @ts-expect-error exploit
    ns.exploit();
}

function rainbow() {
    // @ts-expect-error exploit
    ns.rainbow("noodles");
}

function bypass() {
    // @ts-expect-error exploit
    ns.bypass(doc);
}

function alterReality() {
    // Use browser developer tools to edit source code or value of variable x
}

function prototypeTampering() {
    const originalFunction = Number.prototype.toExponential;
    Number.prototype.toExponential = function (fractionDigits?: number) {
        return originalFunction.apply(this, [fractionDigits]) + " ";
    };
}

function timeCompression() {
    const originalFunction = window.setTimeout;
    window.setTimeout = function (handler: TimerHandler, timeout?: number | undefined, ...args: unknown[]): number {
        if (timeout === 15000) {
            timeout = 250;
        }
        return originalFunction.apply(this, [handler, timeout, ...args]);
    };
}

function trueRecursion() {
    // Make sure you have SF1, then go to Arcade, it will load https://bitburner-official.github.io/bitburner-legacy/
    // Open Developer tools and change line in bundle.js:
    // From: parent.postMessage(__WEBPACK_IMPORTED_MODULE_22__Player_js__["a"].sourceFiles.length > 0, "*")
    // To: parent.postMessage(true, "*")
    // Alternative ways: anything that make Legacy version thinks that you have at least 1 SF. Eg: destroy BN1, edit
    // save file, ...
}

export function exposePlayerObject() {
    if (globalThis.Player) {
        return;
    }
    if (!globalThis.webpackRequire) {
        webpackChunkbitburner.push(
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            [[-1], {}, (webpackRequire: any) => globalThis.webpackRequire = webpackRequire]
        );
    }
    for (const moduleId of Object.keys(webpackRequire.m)) {
        const module = webpackRequire(moduleId);
        if (Object.values(module).length === 0) {
            continue;
        }
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        const player: any = Object.values(module)[0];
        if (!player.money) {
            continue;
        }
        globalThis.Player = player;
        break;
    }
    if (!globalThis.Player) {
        throw new Error("Cannot expose Player object");
    }
}

export function main(nsContext: NS): void {
    ns = nsContext;
    doc = eval("document");
    // unclickable();
    // undocumented();
    // rainbow();
    // bypass();
    // prototypeTampering();
    // timeCompression();
}
